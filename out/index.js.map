{"version":3,"file":"index.js","sources":["../src/index.ts"],"sourcesContent":["import MagicString from 'magic-string';\nimport { join, resolve } from 'path';\nimport rollup from 'rollup';\nimport { createFilter } from 'rollup-pluginutils';\n\ninterface Options {\n  include?: string | string[];\n  exclude?: string | string[];\n  shebang?: string | (() => string);\n}\n\nconst plugin: rollup.PluginImpl<Options> = ({\n  include = ['**/cli.js', '**/bin.js'],\n  exclude,\n  shebang: shebangOption = '#!/usr/bin/env node',\n}: Options = {}) => {\n  const filter = createFilter(include, exclude) as (fileName: string) => boolean;\n\n  return {\n    name: 'shebang',\n    renderChunk(code, { fileName }, { dir, file, sourcemap }) {\n      const outPath = dir ?\n        join(dir, fileName) :\n        file || fileName;\n\n      if (!filter(resolve(outPath))) { return null; }\n\n      const shebang = typeof shebangOption === 'function' ? shebangOption() : shebangOption;\n\n      if (!shebang) {\n        throw new Error('Invalid `shebang` option: Should be a string or a function returning one');\n      }\n\n      const prefix = `${shebang}\n\n`;\n\n      if (!sourcemap) { return `${prefix}${code}`; }\n\n      const s = new MagicString(code);\n\n      s.prepend(prefix);\n\n      return {\n        code: s.toString(),\n        // Need to cast version, as it's declared string\n        // See: https://github.com/Rich-Harris/magic-string/pull/155\n        // (already merged, will be in next release)\n        map: s.generateMap({ hires: true }),\n      };\n    },\n  };\n};\n\nexport default plugin;\n"],"names":["plugin","include","exclude","shebang","shebangOption","filter","createFilter","name","renderChunk","code","fileName","dir","file","sourcemap","outPath","join","resolve","Error","prefix","s","MagicString","prepend","toString","map","generateMap","hires"],"mappings":";;;;;;;;AAWA,MAAMA,MAAkC,GAAG,CAAC;EAC1CC,OAAO,GAAG,CAAC,WAAD,EAAc,WAAd,CADgC;EAE1CC,OAF0C;EAG1CC,OAAO,EAAEC,aAAa,GAAG;IACd,EAJ8B,KAIvB;QACZC,MAAM,GAAGC,8BAAY,CAACL,OAAD,EAAUC,OAAV,CAA3B;SAEO;IACLK,IAAI,EAAE,SADD;;IAELC,WAAW,CAACC,IAAD,EAAO;MAAEC;KAAT,EAAqB;MAAEC,GAAF;MAAOC,IAAP;MAAaC;KAAlC,EAA+C;YAClDC,OAAO,GAAGH,GAAG,GACjBI,SAAI,CAACJ,GAAD,EAAMD,QAAN,CADa,GAEjBE,IAAI,IAAIF,QAFV;;UAII,CAACL,MAAM,CAACW,YAAO,CAACF,OAAD,CAAR,CAAX,EAA+B;eAAS,IAAP;;;YAE3BX,OAAO,GAAG,OAAOC,aAAP,KAAyB,UAAzB,GAAsCA,aAAa,EAAnD,GAAwDA,aAAxE;;UAEI,CAACD,OAAL,EAAc;cACN,IAAIc,KAAJ,CAAU,0EAAV,CAAN;;;YAGIC,MAAM,GAAI,GAAEf,OAAQ;;CAA1B;;UAII,CAACU,SAAL,EAAgB;eAAU,GAAEK,MAAO,GAAET,IAAK,EAAxB;;;YAEZU,CAAC,GAAG,IAAIC,WAAJ,CAAgBX,IAAhB,CAAV;MAEAU,CAAC,CAACE,OAAF,CAAUH,MAAV;aAEO;QACLT,IAAI,EAAEU,CAAC,CAACG,QAAF,EADD;;;;QAKLC,GAAG,EAAEJ,CAAC,CAACK,WAAF,CAAc;UAAEC,KAAK,EAAE;SAAvB;OALP;;;GAzBJ;CAPF;;;;"}